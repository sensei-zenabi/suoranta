<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BUDOSTACK Blog</title>

  <!-- Fonts + Styles -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <meta name="theme-color" content="#0a0f1f">
</head>
<body>
  <!-- Background layers -->
  <div class="bg rain"></div>
  <div class="bg fog"></div>
  <div class="scanlines"></div>

  <header class="site-header">
    <div class="logo glitch" data-text="BUDOSTACK BLOG">BUDOSTACK BLOG</div>
    <p class="tag">The Martial Art of Software - For those about to Zen...</p>
    <nav class="nav">
      <a class="neon-btn" href="https://github.com/sensei-zenabi/BUDOSTACK">REPO</a>
      <a class="neon-btn" href="#about" id="about-btn">ABOUT</a>
      <a class="neon-btn" href="#feed" id="feed-btn">FEED</a>
    </nav>
  </header>

  <div class="content">
    <!-- FEED gets populated from README -->
    <main class="container" id="feed">
      <noscript>
        <article class="card">
          <h2 class="post-title"><span class="jpn">オフライン</span> JavaScript Disabled</h2>
          <p class="meta">Cannot fetch README without JS.</p>
        </article>
      </noscript>
    </main>

    <section class="about container hidden" id="about">
      <h3 class="section-title">ABOUT // OPERATOR</h3>
      <p>
        Built with a passion towards everything nerdy that makes no sense but is fun to create. 
        <br><br>
        BUDOSTACK aims to be a operating system built on top of debian linux, that provides somewhat 
        closed and curated environment for hobbyist with capabilities that make your PC feel like it
        would be from the end of 1980s. Built-in tools cover a curated list of utilities that enable
        everyday tasks typical to the era without having the need to be proficient linux user. In
        addition to tools, there will be a steady roll-out of nostalgic retro games.
        <br><br>
        Currently BUDOSTACK is in Early Access phase where users are able to explore it's capabilities
        without having a guarantee to backwards compatibility from newer versions. The final vision is
        to have a robust system that can be always upgraded using "update" command into a newer version
        using internet connection. When the time is right, the first official version will be launched
        in this website with instructions how to install it.
        <br><br>
        With these words I wish you pleasant retro vibes while using BUDOSTACK.
      </p>
      <img src="images/about.png" alt="About image">
    </section>
  </div>

  <footer class="site-footer">
    <p>© 2025 BUDOSTACK // Off-World Editions</p>
  </footer>

  <!-- Optional Markdown renderer if you later want rich excerpts -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script>
    // ========= CONFIG =========
    const README_URL = 'https://raw.githubusercontent.com/sensei-zenabi/BUDOSTACK/main/users/ville/readme.md';
    const GITHUB_README_PAGE = 'https://github.com/sensei-zenabi/BUDOSTACK/blob/main/users/ville/readme.md';

    // Optional tiny cache (30 min)
    const CACHE_KEY = 'ext_readme_cache_v1:' + README_URL;
    const CACHE_TTL_MS = 30 * 60 * 1000;

    const feedEl = document.getElementById('feed');

    function githubAnchorId(headingText) {
      return headingText
        .trim()
        .toLowerCase()
        .replace(/[^\w\s-]/g, '')
        .replace(/\s+/g, '-');
    }

    function parseDiary(md) {
      const regex = /###\s+(.+?)\s+###\s*\n([\s\S]*?)(?=\n###\s|$)/g;
      const entries = [];
      let m;

      while ((m = regex.exec(md)) !== null) {
        const heading = m[1].trim();
        const body    = (m[2] || '').trim();   // keep entire body
        entries.push({ heading, body });
      }
      return entries;
    }

    function renderEntries(entries) {
      feedEl.innerHTML = '';
      entries.forEach((e, idx) => {
        const anchor = githubAnchorId(e.heading);
        const link   = `${GITHUB_README_PAGE}#${anchor}`;
        const num    = entries.length - idx;

        const article = document.createElement('article');
        article.className = 'card';
        article.innerHTML = `
          <h2 class="post-title">
            <a href="${link}" target="_blank" rel="noopener">
              #${num} - ${e.heading}
            </a>
          </h2>
          <p class="meta">Type: Log Entry · Clearance: Public</p>
          <div class="post-body">
            ${marked.parse(e.body)}           <!-- full post -->
          </div>
          <a class="chip" href="${link}" target="_blank" rel="noopener">
            OPEN FILE
          </a>
        `;
        feedEl.appendChild(article);
      });
    }

    async function loadReadme() {
      try {
        const cached = JSON.parse(localStorage.getItem(CACHE_KEY) || 'null');
        if (cached && (Date.now() - cached.when) < CACHE_TTL_MS) {
          renderEntries(parseDiary(cached.data));
          return;
        }
      } catch (_) {}

      try {
        const res = await fetch(README_URL, { mode: 'cors' });
        if (!res.ok) throw new Error(`Fetch failed: ${res.status} ${res.statusText}`);
        const md = await res.text();
        renderEntries(parseDiary(md));
        localStorage.setItem(CACHE_KEY, JSON.stringify({ when: Date.now(), data: md }));
      } catch (err) {
        console.error(err);
        feedEl.innerHTML = `
          <article class="card">
            <h2 class="post-title">Couldn’t load README</h2>
            <p class="meta">Check the README URL and CORS.</p>
            <p>${String(err)}</p>
          </article>`;
      }
    }

    loadReadme();

    // Toggle between feed and about sections
    const aboutSection = document.getElementById('about');
    const feedSection = document.getElementById('feed');
    document.getElementById('about-btn').addEventListener('click', (e) => {
      e.preventDefault();
      feedSection.classList.add('hidden');
      aboutSection.classList.remove('hidden');
    });
    document.getElementById('feed-btn').addEventListener('click', (e) => {
      e.preventDefault();
      aboutSection.classList.add('hidden');
      feedSection.classList.remove('hidden');
    });

    // Logo flicker
    const logo = document.querySelector('.logo');
    setInterval(() => {
      const n = Math.random();
      logo.style.filter = n > 0.8 ? 'brightness(1.4)' : 'none';
      logo.classList.toggle('flicker', n > 0.85);
    }, 140);

    // Parallax background
    const rain = document.querySelector('.bg.rain');
    const fog = document.querySelector('.bg.fog');
    window.addEventListener('mousemove', (e) => {
      const x = (e.clientX / window.innerWidth - 0.5) * 10;
      const y = (e.clientY / window.innerHeight - 0.5) * 10;
      if (rain) rain.style.transform = `translate(${x}px, ${y}px)`;
      if (fog)  fog.style.transform  = `translate(${-x}px, ${-y}px)`;
    });

    // Smooth scrolling for internal links
    document.querySelectorAll('a[href^="#"]').forEach(link => {
      link.addEventListener('click', (e) => {
        const target = document.getElementById(link.getAttribute('href').slice(1));
        if (target) {
          e.preventDefault();
          target.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });
  </script>
</body>
</html>
